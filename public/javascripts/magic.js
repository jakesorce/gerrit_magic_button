// Generated by CoffeeScript 1.6.2
(function() {
  $(function() {
    var closeHandler, disableActionButtons, unloadConfirm;
    unloadConfirm = function(url, instanceId) {
      var unloadConfirmation;
      unloadConfirmation = confirm('Navigating away will spin down the instance and you will have to start over. Continue?');
      if (unloadConfirmation) {
        $.ajax({
          url: "/cancel_instance",
          data: "instance_id=" + instanceId,
          type: "POST"
        });
        return window.location.href = url;
      }
    };
    closeHandler = function() {
      return $('.back_to_gerrit').bind('click', function(e) {
        e.preventDefault();
        return window.location.href = $('.gerrit_link').attr('href');
      });
    };
    disableActionButtons = function(selector) {
      if (typeof selector === 'undefined') {
        selector = '.modal-footer .btn';
      }
      return $(selector).attr('disabled', 'disabled').addClass('disabled');
    };
    $('#magic_modal').modal({
      keyboard: false,
      backdrop: 'static'
    }, closeHandler());
    $('#generate_button').bind('click', function(e) {
      e.preventDefault();
      $('.error-box').hide();
      disableActionButtons();
      $('#generation_form').submit();
      return $(this).html('Requesting Instance...');
    });
    $('#spin_up_canvas').bind('click', function(e) {
      e.preventDefault();
      disableActionButtons('.load-hide');
      $('.modal-body .label-info').hide();
      $('#canvas_form').hide();
      $('#loading-container').show();
      $('#confirmation_header').html('Loading Environment...');
      $('#game_button').show();
      return $('#canvas_form').submit();
    });
    $('#spin_up_cancel').bind('click', function(e) {
      var answer;
      e.preventDefault();
      answer = confirm("Canceling will take you back to gerrit, proceed?");
      if (answer) {
        $(this).html('Canceling...');
        disableActionButtons();
        return $.post("/cancel_instance?instance_id=" + ($('input[name=instance_id]').val()), function(data) {
          return window.location.href = $('.gerrit_link').attr('href');
        });
      }
    });
    $('#game_hide').bind('click', function(e) {
      e.preventDefault();
      $('#magic_modal').modal('show');
      return $('#game_modal').modal('hide');
    });
    $('#game_button').bind('click', function(e) {
      e.preventDefault();
      $('#magic_modal').modal('hide');
      return $('#game_modal').modal();
    });
    return $('#spin_error').bind('click', function(e) {
      var $errorLogHolder;
      e.preventDefault();
      $errorLogHolder = $('#error_log_holder');
      if ($(this).html() === 'See Server Log') {
        $.get("/error_log?instance_ip=" + ($('#spin_error_instance_ip').val()), function(data) {
          return $errorLogHolder.text(data);
        });
        $('#generation_form').hide();
        $(this).html('Hide Server Log');
        return $errorLogHolder.show();
      } else {
        $errorLogHolder.hide();
        $('#generation_form').show();
        return $(this).html('See Server Log');
      }
    });
  });

}).call(this);
